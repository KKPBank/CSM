@model System.Web.Mvc.HandleErrorInfo
@using CSM.Common.Utilities;
@using log4net;
@{
    ViewBag.Title = "Error";
    Layout = "~/Views/Shared/_Layout.cshtml";
    if (Model != null)
    {
        ILog Logger = LogManager.GetLogger("Error.cshtml");
        LogMessageBuilder _logMsg = new LogMessageBuilder();
        try
        {
            var message = string.Format("Error in Controller {0}, Action method {1}. Exception: {2}",
                Model.ControllerName, Model.ActionName, Model.Exception.Message);
            if (Model.Exception.InnerException != null)
            {
                message += "; Inner exception: " + Model.Exception.InnerException.Message;
            }
            _logMsg.SetPrefixMsg("Error Handle View Start.")
                .SetSuffixMsg("Error Handle View End.")
                .Add("ControllerName", Model.ControllerName)
                .Add("ActionName", Model.ActionName)
                .Add("Exception.Message", Model.Exception.Message)
                .Add("Exception.StackTrace", Model.Exception.StackTrace);
            if (Model.Exception.InnerException != null)
            {
                _logMsg.Add("Exception.InnerException.Message", Model.Exception.InnerException.Message)
                    .Add("Exception.InnerException.StackTrace", Model.Exception.InnerException.StackTrace);
            }
            Logger.Error(_logMsg.ToFailLogString());
        }
        catch (Exception ex)
        {
            Logger.Error("Exception occur:\n", ex);
        }
    }
}

@section MainMenu
{
    @Html.Action("MainMenu", "MenuNavigator", new { selectedMenu = CSM.Entity.MenuCode.NA })
}

<hgroup class="title">
    <h1 class="error">Error.</h1>
    <h2 class="error">An error occurred while processing your request.</h2>
</hgroup>
@if (Model != null && HttpContext.Current.IsDebuggingEnabled)
{
<div>
    <p>
        <b>Exception:</b> @Model.Exception.Message<br />
        <b>Controller:</b> @Model.ControllerName<br />
        <b>Action:</b> @Model.ActionName
    </p>
    <pre>@Model.Exception.StackTrace</pre>
</div>
}
