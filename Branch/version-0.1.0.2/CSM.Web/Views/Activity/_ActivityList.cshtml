@using CSM.Common.Resources
@using CSM.Common.Utilities
@using MvcPaging;
@model CSM.Web.Models.ActivityViewModel
@helper LabelForSort(string headerText, string fieldName, string sortField, string sortOrder)
{
    <a href="javascript:;" onclick="sortField('@fieldName');return false;">
        @headerText
        @if (fieldName.ToLower().Equals(sortField.ToLower()))
        {
            if (sortOrder.Equals("ASC"))
            {<i class="fa fa-sort-asc"></i>}
            else
            {<i class="fa fa-sort-desc"></i> }
        }
        else
        {<i class="fa fa-sort"></i>}
    </a>
}

@Html.HiddenFor(model => model.SearchFilter.IsConnect, new { @id = "hddIsConnect" })
@Html.HiddenFor(model => model.SearchFilter.JsonActivities, new { @id = "hddJsonActivities" })
@if (Model.ActivityList == null || Model.SearchFilter.TotalRecords == 0)
{
    <div class="table-responsive margin-top-10">
        <table class="table table-hover datatable">
            <thead>
                <tr>
                    <!--<th class="center" style="width:5%!important;">Action</th>-->
                    <th style="width:10%!important;" title="เลขที่บัตรประชาชน/นิติบุคคล/Passport/Employee No.">Subscription ID</th>
                    <th style="width:8%!important;">เลขที่สัญญา</th>
                    <th style="width:5%!important;">SR ID<br />/Ticket</th>
                    <th style="width:10%!important;">Product</th>
                    <th style="width:5%!important;">Type</th>
                    <th style="width:5%!important;">Area</th>
                    <th style="width:10%!important;">Sub Area</th>
                    <th style="width:10%!important;">SR Status</th>
                    <th style="width:10%!important;">วันที่บันทึก</th>
                    <th style="width:8%!important;">ผู้บันทึก</th>
                    <th style="width:15%!important;">รายละเอียดการติดต่อ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="11" class="center">@Resource.Msg_NoRecords</td>
                </tr>
            </tbody>
        </table>
    </div>
}
else
{
    string sortField = Model.SearchFilter.SortField;
    string sortOrder = Model.SearchFilter.SortOrder;
    
    <div class="form-inline nopadding">
        <div class="form-group">
            @Html.Raw(Html.Pager(
                new Options
                {
                    PageSize = Model.SearchFilter.PageSize,
                    TotalItemCount = Model.SearchFilter.TotalRecords,
                    CurrentPage = Model.SearchFilter.PageNo,
                    ItemTexts = new ItemTexts
                    {
                        First = "<i class='fa fa-step-backward' style='font-size: 0.8em'></i>",
                        Previous = "<i class='fa fa-caret-left'></i>",
                        Next = "<i class='fa fa-caret-right'></i>",
                        Last = "<i class='fa fa-step-forward' style='font-size: 0.8em'></i>"
                    },
                    IsShowFirstLast = true,
                    CssClass = "pager",
                    IsShowInputPage = true
                },
                new { PageSize = ViewBag.PageSize }))

        </div>
        <div class="form-group">
            @Html.DropDownList("PageSize", new SelectList(ViewBag.PageSizeList, "Key", "Value"), new { @class = "form-control input-xs", id = "pagesizelist" })
        </div>
        <div class="form-group text-nowrap margin-left-8">
            <strong>
                @MvcHtmlString.Create(string.Format(Resource.Lbl_Paging, @Model.SearchFilter.FirstPageIndex, @Model.SearchFilter.LastPageIndex, @Model.SearchFilter.TotalRecordsDisplay))
            </strong>
        </div>
    </div>
    <div class="table-responsive">
        <table id="tblActivityList" class="table datatable">
            <thead>
                <tr>
                    <th class="center text-nowrap" style="width:5%!important;">Action</th>
                    <th class="center text-nowrap" title="เลขที่บัตรประชาชน/นิติบุคคล/Passport/Employee No.">Subscription ID</th>
                    <th class="center text-nowrap">เลขที่สัญญา</th>
                    <th class="center text-nowrap">SR ID/Ticket ID</th>
                    <th class="center text-nowrap">Product</th>
                    <th class="center text-nowrap">Type</th>
                    <th class="center text-nowrap">Area</th>
                    <th class="center text-nowrap">Sub Area</th>
                    <th class="center text-nowrap">SR Status</th>
                    <th class="center text-nowrap">วันที่บันทึก</th>
                    <th class="center text-nowrap">ผู้บันทึก</th>
                    <th class="center text-nowrap">รายละเอียดการติดต่อ</th>
                </tr>
            </thead>
            <tbody>
                @{
    int rowIndex = 1;
                }
                @foreach (var item in Model.ActivityList)
                {
                    string rowId = "act_" + (rowIndex++);
                    <tr>
                        <td class="center">
                            <span class="view" onclick="$jq('#@rowId').toggle('slow')"></span>
                        </td>
                        <td>@item.CustomerInfo.SubscriptionID</td>
                        <td class="center">@item.ContractInfo.AccountNo</td>
                        <td>@item.SrID</td>
                        <td>@item.ProductName</td>
                        <td class="center">@item.TypeName</td>
                        <td>@item.AreaName</td>
                        <td>@item.SubAreaName</td>
                        <td class="center">@item.Status</td>
                        <td class="center">@item.ActivityDateTimeDisplay</td>
                        <td>@item.OfficerInfo.FullName</td>
                        <td>
                            @if (item.ActivityInfo != null && item.ActivityInfo.ActivityDescription != null)
                            {
                                @Html.Raw(StringHelpers.DisplayWithMaxLength(item.ActivityInfo.ActivityDescription)) <span onclick="$jq('#@rowId').toggle('slow')" style="cursor:pointer">...</span>
                            }
                        </td>
                    </tr>
                     if (@item.ActivityInfo != null)
                     {
                         
                    <tr id="@rowId" style="display:none">
                        <td colspan="12">
                            <table class="activity_detail">
                                <tr>
                                    <td style="width:200px">Creator Branch :</td>
                                    <td style="width:200px">@item.ActivityInfo.CreatorBranch</td>
                                    <td style="width:200px">Creator SR :</td>
                                    <td>@item.ActivityInfo.CreatorSR</td>
                                </tr>
                                <tr>
                                    <td>Owner Branch :</td>
                                    <td>@item.ActivityInfo.OwnerBranch</td>
                                    <td>Owner SR :</td>
                                    <td>@item.ActivityInfo.OwnerSR</td>
                                </tr>
                                <tr>
                                    <td>Delegate Branch :</td>
                                    <td>@item.ActivityInfo.DelegateBranch</td>
                                    <td>Delegate SR :</td>
                                    <td>@item.ActivityInfo.DelegateSR</td>
                                </tr>
                                <tr>
                                    <td>Send E-Mail :</td>
                                    <td>@(string.IsNullOrEmpty(item.ActivityInfo.SendEmail) ? "" : item.ActivityInfo.SendEmail.ToUpper() == "Y" ? "Yes" : "No")</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                @if(!string.IsNullOrEmpty(item.ActivityInfo.SendEmail))
                                {
                                    if (item.ActivityInfo.SendEmail.ToUpper() == "Y")
                                    {
                                    <tr>
                                        <td>To :</td>
                                        <td colspan="3">@item.ActivityInfo.EmailTo</td>
                                    </tr>
                                    <tr>
                                        <td>Cc :</td>
                                        <td colspan="3">@item.ActivityInfo.EmailCc</td>
                                    </tr>
                                    <tr>
                                        <td>Subject E-Mail :</td>
                                        <td colspan="3">@item.ActivityInfo.EmailSubject</td>
                                    </tr>
                                    <tr>
                                        <td>E-Mail Body :</td>
                                        <td colspan="3"><div style="width:700px;white-space:normal">@Html.Raw(item.ActivityInfo.EmailBody)</div></td>
                                    </tr>
                                    <tr>
                                        <td>Attachments :</td>
                                        <td colspan="3">@item.ActivityInfo.EmailAttachments</td>
                                    </tr>
                                    }
                                    else
                                    {
                                    <tr>
                                        <td>รายละเอียดการติดต่อ :</td>
                                        <td colspan="3">@Html.Raw(item.ActivityInfo.ActivityDescription)</td>
                                    </tr>
                                    }
                                }
                                <tr>
                                    <td>SR Status :</td>
                                    <td>@item.ActivityInfo.SRStatus</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                     }
                     }
            </tbody>

        </table>
    </div>
}